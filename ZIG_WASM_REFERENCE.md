# Zig WebAssembly ç¼–è¯‘å¿«é€Ÿå‚è€ƒ

> **âš ï¸ é€‚ç”¨ç‰ˆæœ¬**: Zig 0.15.1+ (æ–°ç‰ˆæœ¬è¯­æ³•)

## ğŸš€ æ ‡å‡†ç¼–è¯‘æŒ‡ä»¤

```bash
# è¿›å…¥ç›®å½•
cd zigwasm

# ç¼–è¯‘ WASMï¼ˆåŸºç¡€å‡½æ•°ï¼‰
zig build-exe src/main.zig -target wasm32-freestanding -fno-entry -O ReleaseSmall --export=add --export=multiply --export=fibonacci

# ç¼–è¯‘ WASMï¼ˆåŒ…å«å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼‰
zig build-exe src/main.zig -target wasm32-freestanding -fno-entry -O ReleaseSmall --export=add --export=multiply --export=fibonacci --export=greet --export=reverseString --export=getMemoryAddress --name zigwasm

# å¤åˆ¶åˆ°å°ç¨‹åºç›®å½•
copy zigwasm.wasm ..\miniprogram\zigwasm.wasm
```

## ğŸ“– å‘½ä»¤å‚æ•°è¯¦è§£

### åŸºç¡€å‘½ä»¤ç»“æ„
```bash
zig build-exe src/main.zig -target wasm32-freestanding -fno-entry -O ReleaseSmall --export=å‡½æ•°å --name è¾“å‡ºå
```

### å‚æ•°è¯´æ˜

| å‚æ•° | ä½œç”¨ | è¯´æ˜ |
|------|------|------|
| `build-exe` | ç¼–è¯‘ç±»å‹ | ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆWASMæ¨¡å—ï¼‰ |
| `src/main.zig` | æºæ–‡ä»¶ | è¦ç¼–è¯‘çš„ Zig æºä»£ç æ–‡ä»¶è·¯å¾„ |
| `-target wasm32-freestanding` | ç›®æ ‡å¹³å° | ç¼–è¯‘ä¸º 32ä½ WebAssemblyï¼Œæ— æ“ä½œç³»ç»Ÿä¾èµ– |
| `-fno-entry` | æ— å…¥å£ç‚¹ | ä¸éœ€è¦ main å‡½æ•°ï¼Œç”¨äºåº“æ¨¡å— |
| `-O ReleaseSmall` | ä¼˜åŒ–ç­‰çº§ | ä¼˜åŒ–æ–‡ä»¶å¤§å°ï¼Œé€‚åˆ Web åˆ†å‘ |
| `--export=å‡½æ•°å` | å¯¼å‡ºå‡½æ•° | å°† Zig å‡½æ•°å¯¼å‡ºç»™ JavaScript è°ƒç”¨ |
| `--name zigwasm` | è¾“å‡ºæ–‡ä»¶å | æŒ‡å®šç”Ÿæˆçš„ .wasm æ–‡ä»¶å |

### å…³é”®å‚æ•°è¯¦è§£

**`-target wasm32-freestanding`**
- `wasm32`: 32ä½ WebAssembly æ¶æ„
- `freestanding`: ç‹¬ç«‹ç¯å¢ƒï¼Œä¸ä¾èµ–ç‰¹å®šæ“ä½œç³»ç»Ÿ

**`-fno-entry`** 
- å‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¨‹åº
- ä¸éœ€è¦ `main()` å‡½æ•°ä½œä¸ºç¨‹åºå…¥å£
- ç”¨äºç¼–è¯‘åº“æ¨¡å—å’Œ WASM æ¨¡å—

**`--export=å‡½æ•°å`**
- å¿…é¡»ä¸ºæ¯ä¸ªè¦åœ¨ JavaScript ä¸­è°ƒç”¨çš„å‡½æ•°æ·»åŠ æ­¤å‚æ•°
- ä¸å¯¼å‡ºçš„å‡½æ•° JavaScript æ— æ³•è®¿é—®
- å¯ä»¥é‡å¤ä½¿ç”¨å¯¼å‡ºå¤šä¸ªå‡½æ•°

## ğŸ“‹ å¯¼å‡ºå‡½æ•°è¯´æ˜

### æ•°å­¦è¿ç®—å‡½æ•°
- `add` - åŠ æ³•è¿ç®—
- `multiply` - ä¹˜æ³•è¿ç®—  
- `fibonacci` - æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—

### å­—ç¬¦ä¸²å¤„ç†å‡½æ•°
- `greet` - ç”Ÿæˆé—®å€™è¯­ï¼ˆè¾“å…¥å§“åï¼Œè¿”å›é—®å€™æ–‡æœ¬ï¼‰
- `reverseString` - å­—ç¬¦ä¸²åè½¬

### å†…å­˜ç®¡ç†å‡½æ•°
- `getMemoryAddress` - è·å– WASM å†…å­˜ç¼“å†²åŒºåœ°å€

## ğŸ”§ å‡½æ•°å‚æ•°è¯´æ˜

### å­—ç¬¦ä¸²å‡½æ•°çš„å†…å­˜å¸ƒå±€
```
å†…å­˜ç¼“å†²åŒºåŸºå€ + åç§»é‡:
â”œâ”€â”€ +0     : greet å‡½æ•°è¾“å‡ºåŒºåŸŸ
â”œâ”€â”€ +1024  : reverseString å‡½æ•°è¾“å‡ºåŒºåŸŸ  
â”œâ”€â”€ +2048  : reverseString å‡½æ•°è¾“å…¥åŒºåŸŸ
â””â”€â”€ +3072  : greet å‡½æ•°è¾“å…¥åŒºåŸŸ
```

## ğŸ¯ ä¼˜åŒ–ç­‰çº§

| ä¼˜åŒ–ç­‰çº§ | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|
| `-O Debug` | ç¼–è¯‘å¿«ï¼Œä½“ç§¯å¤§ï¼Œæœ‰è°ƒè¯•ä¿¡æ¯ | å¼€å‘è°ƒè¯• |
| `-O ReleaseSmall` | ä½“ç§¯å°ï¼Œé€‚åˆWebåˆ†å‘ | **ç”Ÿäº§ç¯å¢ƒæ¨è** |
| `-O ReleaseFast` | è¿è¡Œå¿«ï¼Œä½“ç§¯è¾ƒå¤§ | æ€§èƒ½ä¼˜å…ˆ |
| `-O ReleaseSafe` | ä¿ç•™å®‰å…¨æ£€æŸ¥ï¼Œé€‚ä¸­ä½“ç§¯ | å®‰å…¨ä¼˜å…ˆ |

## ğŸ“ è¾“å‡ºæ–‡ä»¶

ç¼–è¯‘æˆåŠŸåç”Ÿæˆï¼š`zigwasm.wasm` (æˆ– `main.wasm`)

## ğŸš¨ é‡è¦æç¤º

1. **å¿…é¡»ä½¿ç”¨** `zig build-exe` è€Œä¸æ˜¯ `build-lib`
2. **å¿…é¡»æ·»åŠ ** `-fno-entry` å‚æ•°
3. **å¿…é¡»æ˜¾å¼å¯¼å‡º** æ¯ä¸ªå‡½æ•° `--export=å‡½æ•°å`
4. **æ¨èä½¿ç”¨** `-O ReleaseSmall` ä¼˜åŒ–ç­‰çº§
5. **å†…å­˜ç®¡ç†** å­—ç¬¦ä¸²å‡½æ•°ä½¿ç”¨ä¸“ç”¨å†…å­˜ç¼“å†²åŒºè¿›è¡Œæ•°æ®äº¤æ¢

## âš ï¸ æ³¨æ„äº‹é¡¹

- å­—ç¬¦ä¸²å‡½æ•°ç›®å‰ä½¿ç”¨è‹±æ–‡è¾“å‡ºé¿å… UTF-8 ç¼–ç é—®é¢˜
- å†…å­˜å¸ƒå±€å›ºå®šï¼Œä¸è¦éšæ„ä¿®æ”¹åç§»é‡
- ç¡®ä¿ JavaScript é€‚é…å™¨ä½¿ç”¨ `getMemoryAddress()` è·å–æ­£ç¡®çš„å†…å­˜åœ°å€

---
ğŸ’¡ **ä¸€é”®ä½¿ç”¨**: ç›´æ¥å¤åˆ¶ä¸Šé¢çš„æ ‡å‡†ç¼–è¯‘æŒ‡ä»¤å³å¯